{
  "permissions": {
    "allow": [
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nApply 4x4 pixel standard to foyer and verb coin\n\n- Foyer: walls, floor, wainscoting, doors, windows updated\n- Furniture repositioned with depth \\(chairs, clock, desk, bookshelf\\)\n- Fireplace with proper stone grid and centered fire\n- Chairs face fireplace in side profile\n- Verb coin updated to match pixel standard\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push)",
      "Bash(git rm:*)",
      "Bash(git commit:*)",
      "Bash(dir:*)",
      "Bash(node --version:*)",
      "Bash(where:*)",
      "Bash(node:*)",
      "Bash(ipconfig:*)",
      "Bash(findstr:*)",
      "Bash(npm:*)",
      "Bash(wc:*)",
      "Bash(grep:*)",
      "Bash(Dialogue\" guardrails to prevent stripping personality from working\ndialogue lines.\n\nCo-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(find:*)",
      "Bash(git checkout:*)",
      "Bash(git -C \"Z:\\\\cursor files\\\\AI Test Project\" log --oneline --all -- \"index-old.html\")",
      "Bash(python -c:*)",
      "Bash(python3 -c \"import openpyxl; wb = openpyxl.load_workbook\\(''TSH_Hotspot_Dialogue_Template.xlsx''\\); print\\(''Sheets:'', wb.sheetnames\\); print\\(''\\\\nDetailed info:''\\); [print\\(f''\\\\n{sheet}:''\\) or [print\\(f''  Row {row}: {[cell.value for cell in ws[row]]}''\\) for row in range\\(1, min\\(51, ws.max_row+1\\)\\)] for sheet, ws in [\\(name, wb[name]\\) for name in wb.sheetnames]]\")",
      "Bash(python -m pip:*)",
      "Bash(pip install:*)",
      "Bash(python3 -m pip install:*)",
      "Bash(python3:*)",
      "Bash(cmd /c \"npm install exceljs\")",
      "Bash(cmd /c \"npm install exceljs 2>&1\")",
      "Bash(cmd.exe /c \"cd /d Z:\\\\cursor files\\\\AI Test Project && npm install exceljs 2>&1\")",
      "Bash(powershell.exe -Command \"Set-Location ''Z:\\\\cursor files\\\\AI Test Project''; npm install exceljs 2>&1\")",
      "Bash(powershell.exe -Command \"where.exe node 2>&1; where.exe npm 2>&1; Get-ChildItem ''C:\\\\Program Files\\\\nodejs'' -ErrorAction SilentlyContinue 2>&1\")",
      "Bash(powershell.exe:*)",
      "Bash(deno run:*)",
      "Bash(deno eval:*)",
      "Bash(\"C:\\\\Users\\\\Chris\\\\AppData\\\\Local\\\\Temp\\\\claude\\\\Z--cursor-files-AI-Test-Project\\\\8f0f5fa4-79a0-4009-b226-2ce80c697070\\\\scratchpad\\\\diag_items.js\" << 'SCRIPTEOF'\n#!/usr/bin/env -S deno run --allow-read --allow-write --allow-env --allow-net\n// ============================================================================\n// DIAGNOSTIC: Why do item descriptions never import from the spreadsheet?\n// ============================================================================\n// This script compares item descriptions in the XLSX \"Global Defaults\" sheet\n// against the descriptions in TSH.Items \\(loaded via eval from items.js\\) to\n// find mismatches and diagnose parsing issues.\n// ============================================================================\n\nimport ExcelJS from 'npm:exceljs@4.4.0';\nimport { resolve, dirname, fromFileUrl } from 'https://deno.land/std/path/mod.ts';\n\n// ── Resolve paths ───────────────────────────────────────────────────────────\nconst SCRIPT_DIR = dirname\\(fromFileUrl\\(import.meta.url\\)\\);\nconst PROJECT_ROOT = resolve\\(\"Z:\\\\\\\\cursor files\\\\\\\\AI Test Project\"\\);\nconst ITEMS_FILE = resolve\\(PROJECT_ROOT, 'src', 'data', 'items', 'items.js'\\);\nconst XLSX_FILE = resolve\\(PROJECT_ROOT, 'TSH_Hotspot_Dialogue.xlsx'\\);\n\n// ============================================================================\n// 1. Load TSH.Items via eval \\(same approach as import script\\)\n// ============================================================================\n\nfunction loadItems\\(\\) {\n    globalThis.TSH = {\n        Rooms: {},\n        Items: {},\n        Combinations: { _recipes: {} },\n        State: {\n            getFlag: \\(\\) => false,\n            hasItem: \\(\\) => false,\n            addItem: \\(\\) => {},\n            removeItem: \\(\\) => {},\n            setFlag: \\(\\) => {},\n        },\n        Actions: {},\n    };\n\n    const code = Deno.readTextFileSync\\(ITEMS_FILE\\);\n    try {\n        const indirectEval = eval;\n        indirectEval\\(code\\);\n    } catch \\(e\\) {\n        console.error\\(`Error eval-ing items.js: ${e.message}`\\);\n    }\n\n    return TSH.Items;\n}\n\n// ============================================================================\n// 2. Cell value helper \\(mirrors import script\\)\n// ============================================================================\n\nfunction cellToString\\(value\\) {\n    if \\(value === null || value === undefined\\) return '';\n    if \\(typeof value === 'object' && value.richText\\) {\n        return value.richText.map\\(r => r.text\\).join\\(''\\);\n    }\n    return value.toString\\(\\);\n}\n\n// ============================================================================\n// 3. Parse the Global Defaults sheet — ITEM DEFAULTS section\n// ============================================================================\n\nfunction parseGlobalDefaults\\(ws\\) {\n    const results = [];\n\n    let inItemSection = false;\n    let itemIdCol = -1;\n    let headerRowNum = -1;\n\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 1: Raw spreadsheet parsing'\\);\n    console.log\\('========================================\\\\n'\\);\n\n    ws.eachRow\\(\\(row, rowNum\\) => {\n        const cellA = \\(row.getCell\\(1\\).value || ''\\).toString\\(\\).trim\\(\\);\n\n        // Log every row to understand structure\n        const cells = [];\n        for \\(let c = 1; c <= Math.min\\(row.cellCount, 6\\); c++\\) {\n            const raw = row.getCell\\(c\\).value;\n            cells.push\\(`col${c}=${JSON.stringify\\(raw\\)}`\\);\n        }\n        console.log\\(`  Row ${rowNum}: ${cells.join\\(' | '\\)}`\\);\n\n        // Detect section headers\n        if \\(cellA === 'ITEM DEFAULTS'\\) {\n            inItemSection = true;\n            console.log\\(`  >>> Found \"ITEM DEFAULTS\" section at row ${rowNum}`\\);\n            return;\n        }\n\n        // Detect the header row inside ITEM DEFAULTS\n        if \\(inItemSection && headerRowNum < 0\\) {\n            // The import script looks for a row with \"Item\" in col A and \"Item ID\" somewhere\n            if \\(cellA === 'Item'\\) {\n                headerRowNum = rowNum;\n                console.log\\(`  >>> Found header row at row ${rowNum}`\\);\n\n                // Find Item ID column\n                for \\(let c = 1; c <= row.cellCount; c++\\) {\n                    const val = \\(row.getCell\\(c\\).value || ''\\).toString\\(\\).trim\\(\\);\n                    if \\(val === 'Item ID'\\) {\n                        itemIdCol = c;\n                        console.log\\(`  >>> \"Item ID\" column found at col ${c}`\\);\n                        break;\n                    }\n                }\n\n                if \\(itemIdCol < 0\\) {\n                    console.log\\(`  >>> WARNING: \"Item ID\" column NOT found in header row!`\\);\n                    // Log all header values\n                    for \\(let c = 1; c <= row.cellCount; c++\\) {\n                        console.log\\(`      Header col ${c}: \"${\\(row.getCell\\(c\\).value || ''\\).toString\\(\\).trim\\(\\)}\"`\\);\n                    }\n                }\n                return;\n            }\n        }\n\n        // Parse item data rows\n        if \\(inItemSection && itemIdCol > 0 && rowNum > headerRowNum\\) {\n            const itemId = \\(row.getCell\\(itemIdCol\\).value || ''\\).toString\\(\\).trim\\(\\);\n            if \\(!itemId\\) return;\n\n            const col2Raw = row.getCell\\(2\\).value;\n            const col2Type = typeof col2Raw;\n            const col2IsRichText = col2Raw && typeof col2Raw === 'object' && col2Raw.richText;\n            const examine = cellToString\\(col2Raw\\);\n\n            results.push\\({\n                rowNum,\n                itemId,\n                examine,\n                col2Type,\n                col2IsRichText: !!col2IsRichText,\n                col2Raw: JSON.stringify\\(col2Raw\\)?.substring\\(0, 120\\),\n            }\\);\n        }\n    }\\);\n\n    return { results, itemIdCol, headerRowNum };\n}\n\n// ============================================================================\n// 4. Compare spreadsheet data with TSH.Items\n// ============================================================================\n\nfunction compare\\(sheetItems, codeItems\\) {\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 3: Comparison \\(Spreadsheet vs Code\\)'\\);\n    console.log\\('========================================\\\\n'\\);\n\n    let matchCount = 0;\n    let diffCount = 0;\n    let missingInCode = 0;\n    let missingInSheet = 0;\n\n    // Check each sheet item against code\n    for \\(const entry of sheetItems\\) {\n        const codeItem = codeItems[entry.itemId];\n        if \\(!codeItem\\) {\n            console.log\\(`  [MISSING IN CODE] ${entry.itemId} — exists in sheet row ${entry.rowNum} but not in TSH.Items`\\);\n            missingInCode++;\n            continue;\n        }\n\n        const codeDesc = codeItem.description || '';\n        const sheetDesc = entry.examine;\n\n        if \\(codeDesc === sheetDesc\\) {\n            matchCount++;\n            console.log\\(`  [MATCH]  ${entry.itemId}`\\);\n        } else {\n            diffCount++;\n            console.log\\(`  [DIFFER] ${entry.itemId}`\\);\n            console.log\\(`           Sheet:  \"${sheetDesc.substring\\(0, 80\\)}${sheetDesc.length > 80 ? '...' : ''}\"`\\);\n            console.log\\(`           Code:   \"${codeDesc.substring\\(0, 80\\)}${codeDesc.length > 80 ? '...' : ''}\"`\\);\n\n            // Detailed character-level diff for first difference\n            for \\(let i = 0; i < Math.max\\(sheetDesc.length, codeDesc.length\\); i++\\) {\n                if \\(sheetDesc[i] !== codeDesc[i]\\) {\n                    const ctx = 20;\n                    console.log\\(`           First diff at char ${i}:`\\);\n                    console.log\\(`             Sheet char: ${JSON.stringify\\(sheetDesc[i]\\)} \\(code ${sheetDesc.charCodeAt\\(i\\)}\\)`\\);\n                    console.log\\(`             Code  char: ${JSON.stringify\\(codeDesc[i]\\)} \\(code ${codeDesc.charCodeAt\\(i\\)}\\)`\\);\n                    console.log\\(`             Sheet context: ...${JSON.stringify\\(sheetDesc.substring\\(Math.max\\(0, i - ctx\\), i + ctx\\)\\)}...`\\);\n                    console.log\\(`             Code  context: ...${JSON.stringify\\(codeDesc.substring\\(Math.max\\(0, i - ctx\\), i + ctx\\)\\)}...`\\);\n                    break;\n                }\n            }\n        }\n    }\n\n    // Check for items in code but not in sheet\n    const sheetIds = new Set\\(sheetItems.map\\(s => s.itemId\\)\\);\n    for \\(const [id, item] of Object.entries\\(codeItems\\)\\) {\n        if \\(!sheetIds.has\\(id\\)\\) {\n            console.log\\(`  [MISSING IN SHEET] ${id} — exists in code but not in spreadsheet`\\);\n            missingInSheet++;\n        }\n    }\n\n    console.log\\(`\\\\n  --- Summary ---`\\);\n    console.log\\(`  Matches:           ${matchCount}`\\);\n    console.log\\(`  Differences:       ${diffCount}`\\);\n    console.log\\(`  Missing in code:   ${missingInCode}`\\);\n    console.log\\(`  Missing in sheet:  ${missingInSheet}`\\);\n\n    return { matchCount, diffCount, missingInCode, missingInSheet };\n}\n\n// ============================================================================\n// 5. Simulate what the import script would do\n// ============================================================================\n\nfunction simulateImport\\(sheetItems, codeItems\\) {\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 4: Simulate import \\(replaceItemDescription\\)'\\);\n    console.log\\('========================================\\\\n'\\);\n\n    const source = Deno.readTextFileSync\\(ITEMS_FILE\\);\n\n    // Replicate the exact regex from replaceItemDescription in import script\n    function escapeRegex\\(str\\) {\n        return str.replace\\(/[.*+?^${}\\(\\)|[\\\\]\\\\\\\\]/g, '\\\\\\\\__HEREDOC_0_bab5d3b9794ffc2d__'\\);\n    }\n\n    for \\(const entry of sheetItems\\) {\n        const itemId = entry.itemId;\n        const newValue = entry.examine;\n\n        // Step 1: Find the id pattern\n        const idPattern = new RegExp\\(`id:\\\\\\\\s*'${escapeRegex\\(itemId\\)}'`\\);\n        const idMatch = idPattern.exec\\(source\\);\n\n        if \\(!idMatch\\) {\n            console.log\\(`  [${itemId}] id pattern NOT FOUND in source`\\);\n            continue;\n        }\n\n        console.log\\(`  [${itemId}] id found at offset ${idMatch.index}`\\);\n\n        // Step 2: Search for description within 500 chars\n        const blockStart = idMatch.index;\n        const searchRegion = source.substring\\(blockStart, blockStart + 500\\);\n        const descPattern = /\\(description:\\\\s*\\)\"\\([^\"\\\\\\\\]*\\(?:\\\\\\\\.[^\"\\\\\\\\]*\\)*\\)\"/s;\n        const descMatch = descPattern.exec\\(searchRegion\\);\n\n        if \\(!descMatch\\) {\n            console.log\\(`    description pattern NOT FOUND in 500-char region`\\);\n            console.log\\(`    Region preview: ${JSON.stringify\\(searchRegion.substring\\(0, 200\\)\\)}`\\);\n            continue;\n        }\n\n        const currentCodeString = `\"${descMatch[2]}\"`;\n        let currentValue;\n        try {\n            const indirectEval = eval;\n            currentValue = indirectEval\\(currentCodeString\\);\n        } catch {\n            currentValue = descMatch[2];\n        }\n\n        const wouldChange = currentValue !== newValue;\n\n        console.log\\(`    description found at offset +${descMatch.index}`\\);\n        console.log\\(`    current \\(from regex\\): \"${currentValue.substring\\(0, 60\\)}${currentValue.length > 60 ? '...' : ''}\"`\\);\n        console.log\\(`    new \\(from sheet\\):     \"${newValue.substring\\(0, 60\\)}${newValue.length > 60 ? '...' : ''}\"`\\);\n        console.log\\(`    would import change?: ${wouldChange ? 'YES' : 'NO \\(identical\\)'}`\\);\n\n        if \\(!wouldChange && currentValue !== newValue\\) {\n            console.log\\(`    WARNING: Values appear different but comparison says equal!`\\);\n        }\n    }\n}\n\n// ============================================================================\n// MAIN\n// ============================================================================\n\nasync function main\\(\\) {\n    console.log\\('=== Item Description Import Diagnostic ===\\\\n'\\);\n\n    // Load code items\n    console.log\\('Loading TSH.Items from items.js...'\\);\n    const codeItems = loadItems\\(\\);\n    console.log\\(`Loaded ${Object.keys\\(codeItems\\).length} items from code.\\\\n`\\);\n\n    // Load spreadsheet\n    console.log\\('Loading spreadsheet...'\\);\n    const wb = new ExcelJS.Workbook\\(\\);\n    await wb.xlsx.readFile\\(XLSX_FILE\\);\n\n    const ws = wb.getWorksheet\\('Global Defaults'\\);\n    if \\(!ws\\) {\n        console.error\\('ERROR: \"Global Defaults\" sheet not found in workbook!'\\);\n        console.log\\('Available sheets:'\\);\n        wb.eachSheet\\(\\(sheet, id\\) => console.log\\(`  [${id}] ${sheet.name}`\\)\\);\n        Deno.exit\\(1\\);\n    }\n\n    console.log\\(`Found \"Global Defaults\" sheet \\(${ws.rowCount} rows\\)\\\\n`\\);\n\n    // Parse sheet\n    const { results: sheetItems, itemIdCol, headerRowNum } = parseGlobalDefaults\\(ws\\);\n\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 2: Parsed item data from sheet'\\);\n    console.log\\('========================================\\\\n'\\);\n\n    console.log\\(`  Item ID column: ${itemIdCol}`\\);\n    console.log\\(`  Header row: ${headerRowNum}`\\);\n    console.log\\(`  Items found: ${sheetItems.length}\\\\n`\\);\n\n    for \\(const entry of sheetItems\\) {\n        console.log\\(`  Row ${entry.rowNum}: id=\"${entry.itemId}\" | type=${entry.col2Type} | richText=${entry.col2IsRichText}`\\);\n        console.log\\(`    examine=\"${entry.examine.substring\\(0, 80\\)}${entry.examine.length > 80 ? '...' : ''}\"`\\);\n        console.log\\(`    raw=${entry.col2Raw}`\\);\n    }\n\n    // Compare\n    const stats = compare\\(sheetItems, codeItems\\);\n\n    // Simulate import\n    simulateImport\\(sheetItems, codeItems\\);\n\n    // Final diagnosis\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('DIAGNOSIS'\\);\n    console.log\\('========================================\\\\n'\\);\n\n    if \\(sheetItems.length === 0\\) {\n        console.log\\('ROOT CAUSE: No items were parsed from the spreadsheet.'\\);\n        console.log\\('The ITEM DEFAULTS section or its header row was not found.'\\);\n        console.log\\('Check the sheet structure — the import script looks for:'\\);\n        console.log\\('  1. A row with \"ITEM DEFAULTS\" in column A'\\);\n        console.log\\('  2. Followed by a row with \"Item\" in col A and \"Item ID\" in some other col'\\);\n    } else if \\(stats.diffCount === 0\\) {\n        console.log\\('ROOT CAUSE: All descriptions ALREADY MATCH between sheet and code.'\\);\n        console.log\\('The import script correctly detects no changes and skips all items.'\\);\n        console.log\\('This is expected behavior — the descriptions are identical.'\\);\n        console.log\\('To test import, manually edit a description in the spreadsheet first.'\\);\n    } else {\n        console.log\\(`Found ${stats.diffCount} differences that SHOULD trigger import.`\\);\n        console.log\\('If the import script reports 0 changes, there may be a regex or'\\);\n        console.log\\('comparison bug in replaceItemDescription\\(\\).'\\);\n    }\n}\n\nmain\\(\\).catch\\(e => {\n    console.error\\('Diagnostic failed:', e\\);\n    Deno.exit\\(1\\);\n}\\);\nSCRIPTEOF)",
      "Bash(base64 << 'B64EOF'\n#!/usr/bin/env -S deno run --allow-read --allow-write --allow-env --allow-net\nimport ExcelJS from 'npm:exceljs@4.4.0';\nimport { resolve, dirname, fromFileUrl } from 'https://deno.land/std/path/mod.ts';\n\nconst PROJECT_ROOT = resolve\\('Z:\\\\\\\\cursor files\\\\\\\\AI Test Project'\\);\nconst ITEMS_FILE = resolve\\(PROJECT_ROOT, 'src', 'data', 'items', 'items.js'\\);\nconst XLSX_FILE = resolve\\(PROJECT_ROOT, 'TSH_Hotspot_Dialogue.xlsx'\\);\n\nfunction loadItems\\(\\) {\n    globalThis.TSH = {\n        Rooms: {},\n        Items: {},\n        Combinations: { _recipes: {} },\n        State: { getFlag: \\(\\) => false, hasItem: \\(\\) => false, addItem: \\(\\) => {}, removeItem: \\(\\) => {}, setFlag: \\(\\) => {} },\n        Actions: {},\n    };\n    const code = Deno.readTextFileSync\\(ITEMS_FILE\\);\n    try { const indirectEval = eval; indirectEval\\(code\\); } catch \\(e\\) { console.error\\('Error eval-ing items.js: ' + e.message\\); }\n    return TSH.Items;\n}\n\nfunction cellToString\\(value\\) {\n    if \\(value === null || value === undefined\\) return '';\n    if \\(typeof value === 'object' && value.richText\\) return value.richText.map\\(r => r.text\\).join\\(''\\);\n    return value.toString\\(\\);\n}\n\nfunction parseGlobalDefaults\\(ws\\) {\n    const results = [];\n    let inItemSection = false;\n    let itemIdCol = -1;\n    let headerRowNum = -1;\n\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 1: Raw spreadsheet parsing'\\);\n    console.log\\('========================================\\\\n'\\);\n\n    ws.eachRow\\(\\(row, rowNum\\) => {\n        const cellA = \\(row.getCell\\(1\\).value || ''\\).toString\\(\\).trim\\(\\);\n        const cells = [];\n        for \\(let c = 1; c <= Math.min\\(row.cellCount, 6\\); c++\\) {\n            cells.push\\('col' + c + '=' + JSON.stringify\\(row.getCell\\(c\\).value\\)\\);\n        }\n        console.log\\('  Row ' + rowNum + ': ' + cells.join\\(' | '\\)\\);\n\n        if \\(cellA === 'ITEM DEFAULTS'\\) { inItemSection = true; console.log\\('  >>> Found ITEM DEFAULTS at row ' + rowNum\\); return; }\n\n        if \\(inItemSection && headerRowNum < 0 && cellA === 'Item'\\) {\n            headerRowNum = rowNum;\n            console.log\\('  >>> Found header row at row ' + rowNum\\);\n            for \\(let c = 1; c <= row.cellCount; c++\\) {\n                const val = \\(row.getCell\\(c\\).value || ''\\).toString\\(\\).trim\\(\\);\n                if \\(val === 'Item ID'\\) { itemIdCol = c; console.log\\('  >>> Item ID column at col ' + c\\); break; }\n            }\n            if \\(itemIdCol < 0\\) {\n                console.log\\('  >>> WARNING: Item ID column NOT found!'\\);\n                for \\(let c = 1; c <= row.cellCount; c++\\) console.log\\('      col ' + c + ': ' + JSON.stringify\\(\\(row.getCell\\(c\\).value || ''\\).toString\\(\\).trim\\(\\)\\)\\);\n            }\n            return;\n        }\n\n        if \\(inItemSection && itemIdCol > 0 && rowNum > headerRowNum\\) {\n            const itemId = \\(row.getCell\\(itemIdCol\\).value || ''\\).toString\\(\\).trim\\(\\);\n            if \\(!itemId\\) return;\n            const col2Raw = row.getCell\\(2\\).value;\n            const examine = cellToString\\(col2Raw\\);\n            results.push\\({ rowNum, itemId, examine, col2Type: typeof col2Raw, col2IsRichText: !!\\(col2Raw && typeof col2Raw === 'object' && col2Raw.richText\\), col2Raw: JSON.stringify\\(col2Raw\\)?.substring\\(0, 120\\) }\\);\n        }\n    }\\);\n    return { results, itemIdCol, headerRowNum };\n}\n\nfunction compare\\(sheetItems, codeItems\\) {\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 3: Comparison \\(Spreadsheet vs Code\\)'\\);\n    console.log\\('========================================\\\\n'\\);\n    let matchCount = 0, diffCount = 0, missingInCode = 0, missingInSheet = 0;\n\n    for \\(const entry of sheetItems\\) {\n        const codeItem = codeItems[entry.itemId];\n        if \\(!codeItem\\) { console.log\\('  [MISSING IN CODE] ' + entry.itemId\\); missingInCode++; continue; }\n        const codeDesc = codeItem.description || '';\n        const sheetDesc = entry.examine;\n        if \\(codeDesc === sheetDesc\\) { matchCount++; console.log\\('  [MATCH]  ' + entry.itemId\\); }\n        else {\n            diffCount++;\n            console.log\\('  [DIFFER] ' + entry.itemId\\);\n            console.log\\('           Sheet:  ' + JSON.stringify\\(sheetDesc.substring\\(0, 80\\)\\)\\);\n            console.log\\('           Code:   ' + JSON.stringify\\(codeDesc.substring\\(0, 80\\)\\)\\);\n            for \\(let i = 0; i < Math.max\\(sheetDesc.length, codeDesc.length\\); i++\\) {\n                if \\(sheetDesc[i] !== codeDesc[i]\\) {\n                    console.log\\('           First diff at char ' + i + ':'\\);\n                    console.log\\('             Sheet char: ' + JSON.stringify\\(sheetDesc[i]\\) + ' \\(charCode ' + \\(sheetDesc[i] ? sheetDesc.charCodeAt\\(i\\) : 'N/A'\\) + '\\)'\\);\n                    console.log\\('             Code  char: ' + JSON.stringify\\(codeDesc[i]\\) + ' \\(charCode ' + \\(codeDesc[i] ? codeDesc.charCodeAt\\(i\\) : 'N/A'\\) + '\\)'\\);\n                    console.log\\('             Sheet ctx: ' + JSON.stringify\\(sheetDesc.substring\\(Math.max\\(0, i-20\\), i+20\\)\\)\\);\n                    console.log\\('             Code  ctx: ' + JSON.stringify\\(codeDesc.substring\\(Math.max\\(0, i-20\\), i+20\\)\\)\\);\n                    break;\n                }\n            }\n        }\n    }\n    const sheetIds = new Set\\(sheetItems.map\\(s => s.itemId\\)\\);\n    for \\(const [id] of Object.entries\\(codeItems\\)\\) { if \\(!sheetIds.has\\(id\\)\\) { console.log\\('  [MISSING IN SHEET] ' + id\\); missingInSheet++; } }\n    console.log\\('\\\\n  --- Summary ---'\\);\n    console.log\\('  Matches:           ' + matchCount\\);\n    console.log\\('  Differences:       ' + diffCount\\);\n    console.log\\('  Missing in code:   ' + missingInCode\\);\n    console.log\\('  Missing in sheet:  ' + missingInSheet\\);\n    return { matchCount, diffCount, missingInCode, missingInSheet };\n}\n\nfunction simulateImport\\(sheetItems\\) {\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 4: Simulate import \\(replaceItemDescription\\)'\\);\n    console.log\\('========================================\\\\n'\\);\n    const source = Deno.readTextFileSync\\(ITEMS_FILE\\);\n    function escapeRegex\\(str\\) { return str.replace\\(/[.*+?^${}\\(\\)|[\\\\]\\\\\\\\]/g, '\\\\\\\\__HEREDOC_0_f9454c4026f21dcc__'\\); }\n\n    for \\(const entry of sheetItems\\) {\n        const itemId = entry.itemId;\n        const newValue = entry.examine;\n        const idPattern = new RegExp\\(\"id:\\\\\\\\s*'\" + escapeRegex\\(itemId\\) + \"'\"\\);\n        const idMatch = idPattern.exec\\(source\\);\n        if \\(!idMatch\\) { console.log\\('  [' + itemId + '] id pattern NOT FOUND'\\); continue; }\n        console.log\\('  [' + itemId + '] id found at offset ' + idMatch.index\\);\n        const searchRegion = source.substring\\(idMatch.index, idMatch.index + 500\\);\n        const descPattern = /\\(description:\\\\s*\\)\"\\([^\"\\\\\\\\]*\\(?:\\\\\\\\.[^\"\\\\\\\\]*\\)*\\)\"/s;\n        const descMatch = descPattern.exec\\(searchRegion\\);\n        if \\(!descMatch\\) { console.log\\('    description pattern NOT FOUND in 500-char region'\\); console.log\\('    Region: ' + JSON.stringify\\(searchRegion.substring\\(0, 200\\)\\)\\); continue; }\n        const currentCodeString = '\"' + descMatch[2] + '\"';\n        let currentValue;\n        try { const indirectEval = eval; currentValue = indirectEval\\(currentCodeString\\); } catch { currentValue = descMatch[2]; }\n        const wouldChange = currentValue !== newValue;\n        console.log\\('    desc found at offset +' + descMatch.index\\);\n        console.log\\('    current \\(regex\\): ' + JSON.stringify\\(currentValue.substring\\(0, 60\\)\\)\\);\n        console.log\\('    new \\(sheet\\):     ' + JSON.stringify\\(newValue.substring\\(0, 60\\)\\)\\);\n        console.log\\('    would change?:   ' + \\(wouldChange ? 'YES' : 'NO \\(identical\\)'\\)\\);\n    }\n}\n\nasync function main\\(\\) {\n    console.log\\('=== Item Description Import Diagnostic ===\\\\n'\\);\n    console.log\\('Loading TSH.Items from items.js...'\\);\n    const codeItems = loadItems\\(\\);\n    console.log\\('Loaded ' + Object.keys\\(codeItems\\).length + ' items from code.\\\\n'\\);\n\n    console.log\\('Loading spreadsheet...'\\);\n    const wb = new ExcelJS.Workbook\\(\\);\n    await wb.xlsx.readFile\\(XLSX_FILE\\);\n    const ws = wb.getWorksheet\\('Global Defaults'\\);\n    if \\(!ws\\) { console.error\\('ERROR: Global Defaults sheet not found!'\\); wb.eachSheet\\(\\(s, id\\) => console.log\\('  [' + id + '] ' + s.name\\)\\); Deno.exit\\(1\\); }\n    console.log\\('Found Global Defaults sheet \\(' + ws.rowCount + ' rows\\)\\\\n'\\);\n\n    const { results: sheetItems, itemIdCol, headerRowNum } = parseGlobalDefaults\\(ws\\);\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('PHASE 2: Parsed item data from sheet'\\);\n    console.log\\('========================================\\\\n'\\);\n    console.log\\('  Item ID column: ' + itemIdCol\\);\n    console.log\\('  Header row: ' + headerRowNum\\);\n    console.log\\('  Items found: ' + sheetItems.length + '\\\\n'\\);\n    for \\(const entry of sheetItems\\) {\n        console.log\\('  Row ' + entry.rowNum + ': id=' + JSON.stringify\\(entry.itemId\\) + ' | type=' + entry.col2Type + ' | richText=' + entry.col2IsRichText\\);\n        console.log\\('    examine=' + JSON.stringify\\(entry.examine.substring\\(0, 80\\)\\)\\);\n        console.log\\('    raw=' + entry.col2Raw\\);\n    }\n\n    const stats = compare\\(sheetItems, codeItems\\);\n    simulateImport\\(sheetItems\\);\n\n    console.log\\('\\\\n========================================'\\);\n    console.log\\('DIAGNOSIS'\\);\n    console.log\\('========================================\\\\n'\\);\n    if \\(sheetItems.length === 0\\) {\n        console.log\\('ROOT CAUSE: No items parsed from the spreadsheet.'\\);\n        console.log\\('The ITEM DEFAULTS section or header row was not found.'\\);\n        console.log\\('Import script looks for: 1\\) row with ITEM DEFAULTS in col A, 2\\) row with Item in col A and Item ID elsewhere'\\);\n    } else if \\(stats.diffCount === 0\\) {\n        console.log\\('ROOT CAUSE: All descriptions ALREADY MATCH between sheet and code.'\\);\n        console.log\\('The import script correctly detects no changes and skips all items.'\\);\n        console.log\\('This is expected -- the descriptions are identical.'\\);\n        console.log\\('To test import, manually edit a description in the spreadsheet first.'\\);\n    } else {\n        console.log\\('Found ' + stats.diffCount + ' differences that SHOULD trigger import.'\\);\n        console.log\\('If the import script reports 0 changes, there may be a regex or comparison bug in replaceItemDescription\\(\\).'\\);\n    }\n}\n\nmain\\(\\).catch\\(e => { console.error\\('Diagnostic failed:', e\\); Deno.exit\\(1\\); }\\);\nB64EOF)",
      "Bash(base64:*)",
      "Bash(line with single 'quotes')",
      "Bash(line with backslash \\\\)",
      "Bash(line with dollar $sign)",
      "Bash(done)",
      "Bash(EOF)",
      "Bash(cmd.exe /c \"node tools\\\\export_dialogue.js\")",
      "Bash(git reset:*)",
      "Bash(identify:*)",
      "Bash(timeout:*)",
      "Bash(powershell -NoProfile -Command:*)",
      "Bash(powershell -NoProfile -File -:*)",
      "Bash(ffmpeg:*)",
      "Bash(move:*)",
      "Bash(exit:*)",
      "Bash(cmd /c \"npm start\")"
    ]
  }
}
